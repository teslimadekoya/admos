{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}Staff Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Staff Management</h1>
</div>

<div class="page-content">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <div class="tabs-nav">
            <button class="tab-btn active" onclick="showTab('admin')">
                Administrators
                <span class="tab-count">{{ staff_by_role.admin.count|default:0 }}</span>
            </button>
            <button class="tab-btn" onclick="showTab('manager')">
                Managers
                <span class="tab-count">{{ staff_by_role.manager.count|default:0 }}</span>
            </button>
            <button class="tab-btn" onclick="showTab('accountant')">
                Accountants
                <span class="tab-count">{{ staff_by_role.accountant.count|default:0 }}</span>
            </button>
        </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Administrators Tab -->
        <div id="admin-tab" class="tab-pane active">
            {% if staff_by_role.admin %}
                <div class="staff-grid">
                    {% for admin in staff_by_role.admin %}
                    <div class="staff-card">
                        <div class="staff-info">
                            <div class="staff-avatar">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="staff-details">
                                <h3>{{ admin.get_full_name|default:"No Name" }}</h3>
                                <p class="staff-role">Administrator</p>
                                <p class="staff-phone">{{ admin.phone_number }}</p>
                                <p class="staff-email">{{ admin.email|default:"No email" }}</p>
                                <p class="staff-password">••••••••</p>
                            </div>
                        </div>
                        <div class="staff-actions">
                            <a href="{% url 'dashboard:edit_staff' admin.id %}" class="btn btn-primary">
                                <i class="fas fa-edit"></i> Edit Login Details
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3>No Administrators</h3>
                    <p>There are currently no administrators in the system.</p>
                </div>
            {% endif %}
        </div>

        <!-- Managers Tab -->
        <div id="manager-tab" class="tab-pane">
            {% if staff_by_role.manager %}
                <div class="staff-grid">
                    {% for manager in staff_by_role.manager %}
                    <div class="staff-card">
                        <div class="staff-info">
                            <div class="staff-avatar">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="staff-details">
                                <h3>{{ manager.get_full_name|default:"No Name" }}</h3>
                                <p class="staff-role">Manager</p>
                                <p class="staff-phone">{{ manager.phone_number }}</p>
                                <p class="staff-email">{{ manager.email|default:"No email" }}</p>
                                <p class="staff-password">••••••••</p>
                            </div>
                        </div>
                        <div class="staff-actions">
                            <a href="{% url 'dashboard:edit_staff' manager.id %}" class="btn btn-primary">
                                <i class="fas fa-edit"></i> Edit Login Details
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3>No Managers</h3>
                    <p>There are currently no managers in the system.</p>
                </div>
            {% endif %}
        </div>

        <!-- Accountants Tab -->
        <div id="accountant-tab" class="tab-pane">
            {% if staff_by_role.accountant %}
                <div class="staff-grid">
                    {% for accountant in staff_by_role.accountant %}
                    <div class="staff-card">
                        <div class="staff-info">
                            <div class="staff-avatar">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="staff-details">
                                <h3>{{ accountant.get_full_name|default:"No Name" }}</h3>
                                <p class="staff-role">Accountant</p>
                                <p class="staff-phone">{{ accountant.phone_number }}</p>
                                <p class="staff-email">{{ accountant.email|default:"No email" }}</p>
                                <p class="staff-password">••••••••</p>
                            </div>
                        </div>
                        <div class="staff-actions">
                            <a href="{% url 'dashboard:edit_staff' accountant.id %}" class="btn btn-primary">
                                <i class="fas fa-edit"></i> Edit Login Details
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h3>No Accountants</h3>
                    <p>There are currently no accountants in the system.</p>
                </div>
            {% endif %}
        </div>

    </div>
</div>

<style>
/* Page Title */
.page-title {
    color: #1C1B1C !important;
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
}

.staff-management {
    padding: 0;
}

.badge {
    padding: 0.375rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.badge-primary { 
    background: linear-gradient(135deg, #C41115 0%, #a00e12 100%); 
    color: white; 
}
.badge-success { 
    background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
    color: white; 
}
.badge-info { 
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
    color: white; 
}

.staff-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
}

.staff-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
}

.staff-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-color: #C41115;
}

.staff-info {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1.25rem;
}

.staff-avatar {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: linear-gradient(135deg, #1C1B1C 0%, #374151 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.1rem;
    flex-shrink: 0;
    border: 2px solid #e5e7eb;
}

.staff-details h3 {
    margin: 0 0 0.5rem 0;
    color: #1C1B1C;
    font-size: 1.1rem;
    font-weight: 600;
}

.staff-role {
    margin: 0 0 0.5rem 0;
    color: #C41115;
    font-weight: 600;
    font-size: 0.9rem;
}

.staff-phone, .staff-email, .staff-password {
    margin: 0 0 0.25rem 0;
    color: #6b7280;
    font-size: 0.875rem;
}

.staff-password {
    font-family: monospace;
    letter-spacing: 1px;
    color: #1C1B1C;
    font-weight: 500;
    background: #f9fafb;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    display: inline-block;
}

.staff-actions {
    display: flex;
    gap: 0.75rem;
}

.btn {
    padding: 0.75rem 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background: linear-gradient(135deg, #C41115 0%, #a00e12 100%);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #a00e12 0%, #8a0c0f 100%);
    color: white;
    text-decoration: none;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(196, 17, 21, 0.3);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #6b7280;
}

.empty-state-icon {
    font-size: 3rem;
    color: #d1d5db;
    margin-bottom: 1.5rem;
}

.empty-state h3 {
    margin-bottom: 0.75rem;
    color: #1C1B1C;
    font-size: 1.25rem;
    font-weight: 600;
}

@media (max-width: 768px) {
    .page-title {
        font-size: 1.5rem;
    }
    
    .staff-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .staff-card {
        padding: 1rem;
    }
    
    .staff-info {
        gap: 0.75rem;
    }
    
    .staff-avatar {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .staff-actions {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .btn {
        justify-content: center;
        padding: 0.625rem 1rem;
    }
}

/* Tabs Styling */
.tabs-container {
    margin-bottom: 2rem;
}

.tabs-nav {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 0;
    overflow-x: auto;
}

.tab-btn {
    background: transparent;
    border: none;
    padding: 1rem 1.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
    position: relative;
}

.tab-btn:hover {
    color: #1C1B1C;
    background: #f9fafb;
}

.tab-btn.active {
    color: #C41115;
    border-bottom-color: #C41115;
    background: #fef8f8;
}

.tab-count {
    background: #e5e7eb;
    color: #6b7280;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    min-width: 1.5rem;
    text-align: center;
}

.tab-btn.active .tab-count {
    background: #C41115;
    color: white;
}

.tab-btn:not(.active) .tab-count {
    background: #e5e7eb;
    color: #6b7280;
}

.tab-content {
    margin-top: 0;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}
</style>

<script>
function showTab(tabName) {
    // Hide all tab panes
    const tabPanes = document.querySelectorAll('.tab-pane');
    tabPanes.forEach(pane => {
        pane.classList.remove('active');
    });
    
    // Remove active class from all tab buttons
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab pane
    const selectedPane = document.getElementById(tabName + '-tab');
    if (selectedPane) {
        selectedPane.classList.add('active');
    }
    
    // Add active class to clicked tab button
    const selectedButton = event.target.closest('.tab-btn');
    if (selectedButton) {
        selectedButton.classList.add('active');
    }
}
</script>
{% endblock %}
